#!/bin/bash

set -e

# ã‚¹ãƒ†ãƒ¼ã‚¸ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ Work Order ãƒ¬ãƒãƒ¼ãƒˆï¼ˆå‘½åè¦å‰‡ã«å¾“ã£ãŸ .mdï¼‰ã‚’æ¢ã™
WO_FILE=$(git diff --cached --name-only | grep -E '^projects/solar_circuit/workorders/reports/wo-[0-9]{8}-[0-9]{3}_report\.md$' | head -n1)

# Work Order ID ã‚’æŠ½å‡ºï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ï¼‰
if [[ -n "$WO_FILE" ]]; then
    WO_ID=$(basename "$WO_FILE" | cut -d_ -f1)
    echo "ğŸ”„ Generating report for ${WO_ID} ..."

    # sc report save ã¸ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚æ¸¡ã™
    sc report save "$WO_ID" "$WO_FILE"
else
    echo "âš ï¸  Work-Order ID not found in staged files â€“ skipping autosave."
fi
