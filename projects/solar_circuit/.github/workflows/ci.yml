# .github/workflows/ci.yml
name: solar-circuit-ci
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with: { python-version: "3.12" }
    - uses: actions/cache@v4
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('projects/solar_circuit/requirements-dev.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    - run: pip install -r requirements-dev.txt
    - run: pip install -e .
    - run: pytest -q
    - name: Run Markdown Lint
      run: npx markdownlint-cli2 "projects/solar_circuit/**/*.md"
    - name: Check for report files
      run: |
        REPORT_COUNT=$(find projects/solar_circuit/workorders/reports/ -maxdepth 1 -name "*_report.md" | wc -l)
        if [ "$REPORT_COUNT" -eq 0 ]; then
          echo "Error: No *_report.md files found in projects/solar_circuit/workorders/reports/."
          exit 1
        fi
